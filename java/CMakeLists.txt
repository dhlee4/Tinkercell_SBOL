SET(LIBRARY_OUTPUT_PATH ${EXECUTABLE_OUTPUT_PATH})

OPTION( EMBED_JAVA "Embed Java in TinkerCell" OFF )

IF(EMBED_JAVA)

FIND_PACKAGE( JNI )
    
IF(JAVA_JVM_LIBRARY AND JAVA_INCLUDE_PATH)

   MESSAGE(STATUS "Using Java library: ${JAVA_JVM_LIBRARY}")
   IF ( JAVA_INCLUDE_PATH2 )
      INCLUDE_DIRECTORIES( BEFORE ${JAVA_INCLUDE_PATH} ${JAVA_INCLUDE_PATH2})
   ELSE ( JAVA_INCLUDE_PATH2 )
      INCLUDE_DIRECTORIES( BEFORE ${JAVA_INCLUDE_PATH})
   ENDIF ( JAVA_INCLUDE_PATH2 )
   #LINK_DIRECTORIES( BEFORE ${JAVA_LIB_DIR})

  IF ( WIN32 )
      ADD_DEFINITIONS(-D_WIN32)
      IF (MINGW)
         ADD_DEFINITIONS(-D__MINGW32__)
		 IF (USE_STDCALL)
			ADD_DEFINITIONS(-DUSE_STDCALL)
		 ENDIF(USE_STDCALL)
      ENDIF(MINGW)
  ENDIF( WIN32 )

   FILE(GLOB TCAPI_SRC ${TINKERCELL_SOURCE_DIR}/API/*.c)

   #embed
   ADD_LIBRARY( tinkercell
      SHARED
      runjava.cpp
      tinkercell_wrap.c
      ${TCAPI_SRC}
  )

   TARGET_LINK_LIBRARIES( tinkercell
      tinkercell
      ${JAVA_JVM_LIBRARY}
  )
 
  INSTALL(TARGETS tinkercell DESTINATION bin/../)

  FILE(GLOB JAVA_FILES *.java *.class)

  INSTALL(FILES ${JAVA_FILES}
     DESTINATION bin/../
     COMPONENT Java
   )

ELSE(JAVA_JVM_LIBRARY AND JAVA_INCLUDE_PATH)

    MESSAGE("Please define the following FILEPATH items: JAVA_JVM_LIBRARY AND JAVA_INCLUDE_PATH")

ENDIF(JAVA_JVM_LIBRARY AND JAVA_INCLUDE_PATH)

ENDIF(EMBED_JAVA)

